@tailwind base;
@tailwind components;
@tailwind utilities;

/* Mobile-specific behavior */
@media (max-width: 767px) {
    /* Hide footer on mobile */
    footer {
        display: none !important;
    }
    
    /* Center title and date on mobile */
    .mobile-article.prose.prose-invert h1 {
        text-align: center !important;
    }
    
    .mobile-article .text-sm.text-muted-foreground {
        text-align: center !important;
    }
}

/* ---------- Gruvbox DARK palette (from your image) ---------- */
/* raw palette (kept as g- variables for reuse anywhere) */
:root {
    /* backgrounds */
    --g-bg0_h: #1d2021;
    /* hard */
    --g-bg0: #282828;
    --g-bg0_s: #32302f;
    /* soft */
    --g-bg1: #3c3836;
    --g-bg2: #504945;
    --g-bg3: #665c54;
    --g-bg4: #7c6f64;

    /* foregrounds */
    --g-fg0: #fbf1c7;
    --g-fg1: #ebdbb2;
    --g-fg2: #d5c4a1;
    --g-fg3: #bdae93;
    --g-fg4: #a89984;

    /* accents */
    --g-red: #cc241d;
    --g-red-br: #fb4934;
    --g-green: #98971a;
    --g-green-br: #b8bb26;
    --g-yellow: #d79921;
    --g-yellow-br: #fabd2f;
    --g-blue: #458588;
    --g-blue-br: #83a598;
    --g-purple: #b16286;
    --g-purple-br: #d3869b;
    --g-aqua: #689d6a;
    --g-aqua-br: #8ec07c;
    --g-orange: #d65d0e;
    --g-orange-br: #fe8019;

    /* ---------- shadcn/ui theme mapping (DARK as default) ---------- */
    --background: var(--g-bg0_h);
    /* page */
    --foreground: var(--g-fg1);

    --card: var(--g-bg0);
    /* panels */
    --card-foreground: var(--g-fg1);

    --popover: var(--g-bg0_s);
    --popover-foreground: var(--g-fg1);

    --primary: var(--g-aqua-br);
    /* main accent */
    --primary-foreground: var(--g-bg0_h);

    --secondary: var(--g-orange-br);
    /* secondary accent (buttons, chips) */
    --secondary-foreground: var(--g-bg0_h);

    --muted: var(--g-bg1);
    /* subdued surfaces */
    --muted-foreground: var(--g-fg3);

    --accent: var(--g-blue-br);
    --accent-foreground: var(--g-bg0_h);

    --destructive: var(--g-red-br);
    --destructive-foreground: var(--g-bg0_h);

    --border: var(--g-bg2);
    --input: var(--g-bg2);
    --ring: var(--g-aqua-br);

    --radius: 10px;
    --header-h: 56px;
}

/* ---------- Base reset + subtle SOC texture (dark) ---------- */
@layer base {
    * {
        @apply border-border;
        box-sizing: border-box;
    }

    html {
        height: 100vh;
        height: 100dvh;
        overflow: hidden;
    }

    body {
        height: 100vh;
        height: 100dvh;
        margin: 0;
        padding: 0;
        overflow: hidden;
        @apply bg-background text-foreground;
        background-image:
            radial-gradient(circle at 1px 1px, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
            linear-gradient(transparent 0, rgba(255, 255, 255, 0.025) 1px);
        background-size: 22px 22px, 100% 2px;
        background-repeat: repeat, repeat;
        background-attachment: fixed;
    }
}

/* ---------- SIEM panels & helpers ---------- */
@layer utilities {
    .panel {
        position: relative;
        border-radius: var(--radius);
        box-shadow:
            inset 0 1px 0 rgba(255, 255, 255, 0.04),
            0 0 0 1px rgba(142, 192, 124, 0.08),
            /* aqua glow */
            0 10px 28px rgba(0, 0, 0, 0.45);
        background: var(--card);
    }

    .panel::before {
        content: "";
        position: absolute;
        inset: -1px;
        border-radius: inherit;
        padding: 1px;
        background: linear-gradient(135deg, rgba(142, 192, 124, 0.36), rgba(142, 192, 124, 0.06));
        -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        pointer-events: none;
    }

    .panel-header {
        position: relative;
    }

    .panel-header::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        bottom: -4px;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(142, 192, 124, 0.7), transparent);
    }

    .mono-accent {
        @apply font-mono tracking-tight;
    }

    .zebra tbody tr:nth-child(odd) {
        background-color: rgba(255, 255, 255, 0.03);
    }

    .input-neo:focus-visible {
        box-shadow: 0 0 0 2px var(--ring), 0 0 0 4px rgba(142, 192, 124, 0.28);
        outline: none;
    }

    /* CSS-variable alpha helpers (no bg-muted/40 etc.) */
    .bg-muted-10 {
        background-color: color-mix(in srgb, var(--muted) 10%, transparent);
    }

    .bg-muted-20 {
        background-color: color-mix(in srgb, var(--muted) 20%, transparent);
    }

    .bg-muted-30 {
        background-color: color-mix(in srgb, var(--muted) 30%, transparent);
    }

    .bg-muted-40 {
        background-color: color-mix(in srgb, var(--muted) 40%, transparent);
    }

    .bg-muted-60 {
        background-color: color-mix(in srgb, var(--muted) 60%, transparent);
    }

    /* darker info box specifically for selected-post description */
    .infobox {
        background-color: var(--g-bg0_h);
        /* clearly darker than panel */
        border: 1px solid var(--g-bg2);
        border-radius: 8px;
    }

    .capsule {
        @apply rounded-full px-2 py-[2px] text-[11px] font-mono;
    }

    .capsule {
        background-color: color-mix(in srgb, var(--muted) 40%, transparent);
    }

        /* ----- colored pills (driven by CSS variables) ----- */
        .pill {
            @apply inline-flex items-center rounded-full px-2.5 py-[3px] text-[11px] font-mono border transition-colors;
            background-color: var(--pill-bg, transparent);
            color: var(--pill-fg, var(--foreground));
            border-color: var(--pill-bd, var(--border));
        }
    
        .pill:focus-visible {
            outline: none;
            box-shadow: 0 0 0 2px var(--ring), 0 0 0 4px color-mix(in srgb, var(--ring) 35%, transparent);
        }
    
        .pill:hover {
            filter: brightness(1.05);
        }
}

/* ---- CLI blink + caret helpers ---- */
@keyframes caret-blink {

    0%,
    49% {
        opacity: 1;
    }

    50%,
    100% {
        opacity: 0;
    }
}

.caret-blink {
    animation: caret-blink 1s steps(1, end) infinite;
}

@layer components {
    .kbd {
        @apply rounded border border-border bg-muted/20 px-1.5 py-0.5 font-mono text-xs;
    }
}

/* Ensure no unwanted scrollbars */
@layer base {
    #__next {
        height: 100vh;
        height: 100dvh;
        overflow: hidden;
    }
    
    /* Hide scrollbar in main content area while keeping scroll functionality */
    main {
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE/Edge */
    }
    
    main::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
    }
    
    /* Hide footer on small screens */
    html.hide-footer footer {
        display: none;
    }
    
    /* Custom scrollbar styling for posts list */
    .posts-scrollbar {
        scrollbar-width: thin;
        scrollbar-color: var(--g-bg3) var(--g-bg1);
    }
    
    .posts-scrollbar::-webkit-scrollbar {
        width: 8px;
    }
    
    .posts-scrollbar::-webkit-scrollbar-track {
        background: var(--g-bg1);
        border-radius: 4px;
    }
    
    .posts-scrollbar::-webkit-scrollbar-thumb {
        background: var(--g-bg3);
        border-radius: 4px;
        border: 1px solid var(--g-bg2);
    }
    
    .posts-scrollbar::-webkit-scrollbar-thumb:hover {
        background: var(--g-bg4);
    }
    
    /* Posts container with fade effect */
    .posts-container {
        position: relative;
    }
    
    .posts-container::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 32px;
        background: linear-gradient(to bottom, transparent, var(--card));
        pointer-events: none;
        z-index: 1;
    }
    
    /* Add spacing after the last table row */
    .posts-table tbody tr:last-child td {
        padding-bottom: 24px;
    }
}

/* Mobile-friendly blog post styles */
@layer utilities {
    /* Force prose content to respect viewport boundaries */
    .prose {
        max-width: 100vw !important;
        width: 100% !important;
        box-sizing: border-box !important;
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
        overflow-x: hidden !important;
    }

    /* Aggressive container constraints */
    .prose * {
        max-width: 100% !important;
        box-sizing: border-box !important;
    }

    /* Mobile-friendly code blocks */
    .prose pre {
        max-width: calc(100vw - 2rem) !important;
        overflow-x: auto;
        white-space: pre;
        word-wrap: normal;
        word-break: normal;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }

    .prose pre code {
        white-space: pre;
        word-wrap: normal;
        word-break: normal;
        max-width: 100% !important;
    }

    /* Mobile-friendly inline code */
    .prose :where(code):not(:where([class~="not-prose"] *)) {
        word-break: break-all !important;
        white-space: pre-wrap;
        max-width: 100% !important;
    }

    /* Mobile-friendly tables - force horizontal scroll */
    .prose table {
        width: 100%;
        max-width: calc(100vw - 2rem) !important;
        overflow-x: auto;
        display: block;
        white-space: nowrap;
        margin: 1rem 0 !important;
    }

    .prose thead,
    .prose tbody,
    .prose tr {
        display: table;
        width: max-content;
        min-width: 100%;
        table-layout: auto;
    }

    .prose th,
    .prose td {
        word-wrap: break-word;
        word-break: break-word;
        hyphens: auto;
        min-width: 80px;
        max-width: 200px;
        white-space: normal;
        padding: 0.5rem !important;
    }

    /* Aggressively constrain images */
    .prose img {
        max-width: calc(100vw - 2rem) !important;
        width: 100% !important;
        height: auto !important;
        display: block;
        margin: 1rem auto !important;
        object-fit: contain;
    }

    /* Aggressive mobile constraints */
    @media (max-width: 768px) {
        /* Force everything to respect viewport */
        .prose {
            padding: 0 !important;
            margin: 0 !important;
            width: 100vw !important;
            max-width: 100vw !important;
            overflow-x: hidden !important;
        }

        .prose > * {
            max-width: calc(100vw - 1rem) !important;
            margin-left: 0.5rem !important;
            margin-right: 0.5rem !important;
        }
        
        /* Severely constrain images on mobile */
        .prose img {
            max-width: calc(100vw - 1rem) !important;
            width: auto !important;
            height: auto !important;
            margin: 0.5rem auto !important;
        }

        /* Make table scrollable on very small screens */
        .prose table {
            font-size: 0.75rem !important;
            white-space: nowrap;
            overflow-x: auto;
            display: block;
            max-width: calc(100vw - 1rem) !important;
            margin: 0.5rem auto !important;
        }
        
        .prose table thead,
        .prose table tbody,
        .prose table tr {
            display: table;
            width: max-content;
            min-width: 100%;
        }

        /* Constrain code blocks aggressively */
        .prose pre {
            font-size: 0.65rem !important;
            padding: 0.5rem !important;
            margin: 0.5rem 0 !important;
            max-width: calc(100vw - 1rem) !important;
            overflow-x: auto !important;
        }

        .prose code {
            font-size: 0.75rem !important;
            word-break: break-all !important;
        }

        /* Better mobile typography */
        .prose h1 { font-size: 1.75rem !important; line-height: 1.2 !important; }
        .prose h2 { font-size: 1.5rem !important; line-height: 1.3 !important; }
        .prose h3 { font-size: 1.25rem !important; line-height: 1.4 !important; }
        .prose h4 { font-size: 1.125rem !important; line-height: 1.4 !important; }

        .prose h1,
        .prose h2,
        .prose h3,
        .prose h4,
        .prose h5,
        .prose h6 {
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            hyphens: auto !important;
            margin-left: 0.5rem !important;
            margin-right: 0.5rem !important;
        }

        /* Handle long URLs and links better on mobile */
        .prose a {
            word-break: break-all !important;
            overflow-wrap: break-word !important;
        }

        /* Handle blockquotes on mobile */
        .prose blockquote {
            margin-left: 0.5rem !important;
            margin-right: 0.5rem !important;
            padding-left: 1rem !important;
            padding-right: 0.5rem !important;
            max-width: calc(100vw - 1rem) !important;
        }

        /* Paragraphs and lists */
        .prose p,
        .prose ul,
        .prose ol {
            margin-left: 0.5rem !important;
            margin-right: 0.5rem !important;
        }
    }

    /* Force break long words and URLs anywhere */
    .prose p,
    .prose li,
    .prose td {
        overflow-wrap: break-word;
        word-wrap: break-word;
        word-break: break-word;
    }

    /* Specific handling for very long strings like hashes, URLs, etc. */
    .prose code:not(pre code) {
        word-break: break-all;
        white-space: pre-wrap;
    }

    /* Mobile article overrides - simplified */
    @media (max-width: 768px) {
        .mobile-article {
            max-width: 100vw;
            width: 100%;
            padding: 0 1rem;
            margin: 0;
        }

        /* Override all prose children with highest specificity */
        .mobile-article.prose.prose-invert * {
            max-width: calc(100vw - 1rem) !important;
            box-sizing: border-box !important;
        }

        /* Images - force small size on mobile */
        .mobile-article.prose.prose-invert img {
            max-width: calc(100vw - 1rem) !important;
            width: 100% !important;
            height: auto !important;
            margin: 0.5rem 0 !important;
            display: block !important;
        }

        /* Code blocks - work with existing highlight.css structure */
        .mobile-article.prose.prose-invert pre {
            max-width: calc(100vw - 2rem) !important;
            overflow-x: auto !important;
            margin: 0.5rem 0 !important;
            /* Keep existing transparent background from highlight.css */
        }
        
        .mobile-article.prose.prose-invert pre code.hljs {
            font-size: 0.7rem !important;
            padding: 0.5rem !important;
            /* Override the fixed padding from highlight.css on mobile */
            width: max-content !important;
            min-width: 100% !important;
            /* This ensures background extends with content */
        }

        /* Tables - force small and scrollable */
        .mobile-article.prose.prose-invert table {
            max-width: calc(100vw - 1rem) !important;
            font-size: 0.7rem !important;
            display: block !important;
            overflow-x: auto !important;
            white-space: nowrap !important;
            margin: 0.5rem 0 !important;
        }

        /* Headings */
        .mobile-article.prose.prose-invert h1,
        .mobile-article.prose.prose-invert h2,
        .mobile-article.prose.prose-invert h3,
        .mobile-article.prose.prose-invert h4,
        .mobile-article.prose.prose-invert h5,
        .mobile-article.prose.prose-invert h6 {
            font-size: clamp(1rem, 4vw, 1.5rem) !important;
            line-height: 1.3 !important;
            margin: 0.75rem 0 0.5rem 0 !important;
            word-break: break-word !important;
        }

        /* Paragraphs and lists */
        .mobile-article.prose.prose-invert p,
        .mobile-article.prose.prose-invert ul,
        .mobile-article.prose.prose-invert ol,
        .mobile-article.prose.prose-invert li {
            font-size: 0.9rem !important;
            line-height: 1.5 !important;
            margin: 0.5rem 0 !important;
            word-break: break-word !important;
        }

        /* Links and inline code */
        .mobile-article.prose.prose-invert a,
        .mobile-article.prose.prose-invert code:not(pre code) {
            word-break: break-all !important;
            overflow-wrap: break-word !important;
        }

        /* Blockquotes */
        .mobile-article.prose.prose-invert blockquote {
            margin: 0.5rem 0 !important;
            padding: 0.5rem 1rem !important;
            font-size: 0.85rem !important;
        }
    }
}